```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Single-Issue GitHub Chat</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;max-width:900px;margin:2rem auto;padding:0 1rem}
    #messages{border:1px solid #ddd;padding:1rem;min-height:240px;overflow:auto;background:#fff}
    .msg{margin:0 0 1rem 0;padding-bottom:.5rem;border-bottom:1px dashed #eee}
    .meta{color:#666;font-size:.9rem;display:flex;align-items:center;gap:.5rem;margin-bottom:.25rem}
    .avatar{width:28px;height:28px;border-radius:50%}
    #composer{margin-top:1rem;display:flex;gap:.5rem}
    #text{flex:1;padding:.5rem}
    button{padding:.45rem .6rem}
    input{padding:.4rem}
  </style>
</head>
<body>
  <h1>Chat (single GitHub issue)</h1>

  <div>
    <label>Display name: <input id="displayName" placeholder="your name (optional)"></label>
  </div>

  <div style="margin-top:8px;">
    <div class="small">Chat thread (owner/repo#issue):</div>
    <input id="owner" placeholder="owner" style="width:30ch" /> <input id="repo" placeholder="repo" style="width:30ch" /> <input id="issue" placeholder="issue number" style="width:10ch" />
    <button id="saveThread">Save</button>
  </div>

  <div id="messages" aria-live="polite">Loading messages…</div>

  <div id="composer">
    <input id="text" placeholder="Type a message..." />
    <button id="send">Send</button>
  </div>

  <script>
    // Edit this to your deployed backend URL after you deploy it:
    const BACKEND_URL = "https://YOUR-BACKEND.example.com"; // <-- REPLACE

    const ownerInput = document.getElementById('owner');
    const repoInput = document.getElementById('repo');
    const issueInput = document.getElementById('issue');
    const displayNameInput = document.getElementById('displayName');
    const messagesDiv = document.getElementById('messages');
    const textInput = document.getElementById('text');
    const sendBtn = document.getElementById('send');
    const saveThreadBtn = document.getElementById('saveThread');

    ownerInput.value = localStorage.getItem('chat_owner') || '';
    repoInput.value = localStorage.getItem('chat_repo') || '';
    issueInput.value = localStorage.getItem('chat_issue') || '';
    displayNameInput.value = localStorage.getItem('chat_display') || '';

    saveThreadBtn.addEventListener('click', () => {
      localStorage.setItem('chat_owner', ownerInput.value.trim());
      localStorage.setItem('chat_repo', repoInput.value.trim());
      localStorage.setItem('chat_issue', issueInput.value.trim());
      loadMessages();
    });

    displayNameInput.addEventListener('change', () => localStorage.setItem('chat_display', displayNameInput.value.trim()));

    function escapeHtml(s="") {
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]));
    }

    async function loadMessages() {
      const owner = (ownerInput.value || '').trim();
      const repo = (repoInput.value || '').trim();
      const issue = (issueInput.value || '').trim();
      if (!owner || !repo || !issue) {
        messagesDiv.textContent = 'Set owner, repo and issue number then click Save.';
        return;
      }
      messagesDiv.textContent = 'Loading messages…';
      try {
        // We call the GitHub API directly for reads to avoid round-trip through backend (optional).
        // You can also fetch from BACKEND_URL + '/messages' if you prefer the server to proxy reads.
        const url = `https://api.github.com/repos/${owner}/${repo}/issues/${issue}/comments?per_page=100`;
        const r = await fetch(url, { headers: { Accept: 'application/vnd.github.v3+json' } });
        if (!r.ok) {
          messagesDiv.textContent = `Failed to load messages (status ${r.status})`;
          return;
        }
        const arr = await r.json();
        messagesDiv.innerHTML = '';
        for (const c of arr) {
          const el = document.createElement('div');
          el.className = 'msg';
          // Show server-authored user (the bot) as comment author, and display-name inside comment body is what the sender set.
          el.innerHTML = `<div class="meta"><img class="avatar" src="${c.user?.avatar_url||''}" /> <strong>${escapeHtml(c.user?.login||'github')}</strong> <span style="margin-left:8px;color:#777">${new Date(c.created_at).toLocaleString()}</span></div>
                          <div class="body">${escapeHtml(c.body || '')}</div>
                          <div style="margin-top:6px"><a href="${c.html_url}" target="_blank" rel="noopener">View on GitHub</a></div>`;
          messagesDiv.appendChild(el);
        }
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      } catch (e) {
        console.error(e);
        messagesDiv.textContent = 'Error loading messages';
      }
    }

    async function sendMessage() {
      const owner = (ownerInput.value || '').trim();
      const repo = (repoInput.value || '').trim();
      const issue = (issueInput.value || '').trim();
      if (!owner || !repo || !issue) return alert('Set owner, repo and issue number and click Save.');
      const msg = textInput.value.trim();
      if (!msg) return;
      sendBtn.disabled = true;
      try {
        const payload = { displayName: displayNameInput.value.trim() || undefined, message: msg, owner, repo, issue };
        const res = await fetch(BACKEND_URL + '/messages', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const j = await res.json().catch(()=>null);
        if (!res.ok) {
          alert('Failed to send: ' + (j && j.error ? j.error : res.statusText));
        } else {
          textInput.value = '';
          await loadMessages();
        }
      } catch (e) {
        console.error(e);
        alert('Network error');
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener('click', sendMessage);
    textInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });

    // initial load
    loadMessages();
    setInterval(loadMessages, 10_000);
  </script>
</body>
</html>
